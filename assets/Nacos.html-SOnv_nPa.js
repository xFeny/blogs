import{_ as o}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as c,o as l,c as p,a,b as s,d as e,e as t}from"./app-avRldafL.js";const i={},r=t('<h1 id="alibaba-nacos-相关" tabindex="-1"><a class="header-anchor" href="#alibaba-nacos-相关" aria-hidden="true">#</a> Alibaba Nacos 相关</h1><h2 id="一、centos-下安装-nacos" tabindex="-1"><a class="header-anchor" href="#一、centos-下安装-nacos" aria-hidden="true">#</a> 一、CentOS 下安装 Nacos</h2><h3 id="单机模式运行" tabindex="-1"><a class="header-anchor" href="#单机模式运行" aria-hidden="true">#</a> 单机模式运行</h3><h4 id="第一步、最新版安装包" tabindex="-1"><a class="header-anchor" href="#第一步、最新版安装包" aria-hidden="true">#</a> 第一步、最新版安装包</h4>',4),d=a("code",null,"Nacos GitHub",-1),u={href:"https://github.com/alibaba/nacos/releases/",target:"_blank",rel:"noopener noreferrer"},v=a("code",null,"Nacos ",-1),m=t(`<img src="http://oss.feny.ink/blogs/images/202401011303922.png" alt="image-20240101130354872" style="zoom:50%;"><h4 id="第二步、下载解压缩。" tabindex="-1"><a class="header-anchor" href="#第二步、下载解压缩。" aria-hidden="true">#</a> 第二步、下载解压缩。</h4><p>进入或创建一个你喜欢的目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://github.com/alibaba/nacos/releases/download/2.3.0/nacos-server-2.3.0.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> nacos-server-2.3.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第三步、初始化数据库表" tabindex="-1"><a class="header-anchor" href="#第三步、初始化数据库表" aria-hidden="true">#</a> 第三步、初始化数据库表</h4><p>创建名为<code>nacos</code>的数据库，之后使用 <code>MySQL</code> 客户端执行 <code>nacos/conf/mysql-schema.sql</code> 文件，完成建表工作。 <img src="http://oss.feny.ink/blogs/images/202312281325914.png" alt="" loading="lazy"></p><h4 id="第四步、配置-nacos-数据源" tabindex="-1"><a class="header-anchor" href="#第四步、配置-nacos-数据源" aria-hidden="true">#</a> 第四步、配置 Nacos 数据源</h4><p>找到配置文件 <code>application.properties</code>，文件路径如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>nacos/conf/application.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>默认数据源配置都被<code>#</code>号注释，删除注释按下方示例配置数据源即可。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">spring.sql.init.platform</span><span class="token operator">=</span>mysql

<span class="token comment">### Count of DB:</span>
<span class="token assign-left variable">db.num</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">### Connect URL of DB:</span>
<span class="token assign-left variable">db.url.0</span><span class="token operator">=</span>jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span><span class="token assign-left variable">connectTimeout</span><span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span><span class="token assign-left variable">socketTimeout</span><span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span><span class="token assign-left variable">autoReconnect</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useUnicode</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false<span class="token operator">&amp;</span><span class="token assign-left variable">serverTimezone</span><span class="token operator">=</span>UTC<span class="token operator">&amp;</span><span class="token assign-left variable">allowPublicKeyRetrieval</span><span class="token operator">=</span>true
<span class="token assign-left variable">db.user.0</span><span class="token operator">=</span>root
<span class="token assign-left variable">db.password.0</span><span class="token operator">=</span><span class="token number">123456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>遇到的问题</strong><code>Nacos</code>启动时报以下错误错：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Caused by: com.mysql.cj.exceptions.UnableToConnectException: Public Key Retrieval is not allowed
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
        at sun.reflect.NativeConstructorAccessorImpl.newInstance<span class="token punctuation">(</span>NativeConstructorAccessorImpl.java:62<span class="token punctuation">)</span>
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance<span class="token punctuation">(</span>DelegatingConstructorAccessorImpl.java:45<span class="token punctuation">)</span>
        at java.lang.reflect.Constructor.newInstance<span class="token punctuation">(</span>Constructor.java:423<span class="token punctuation">)</span>
        at com.mysql.cj.exceptions.ExceptionFactory.createException<span class="token punctuation">(</span>ExceptionFactory.java:61<span class="token punctuation">)</span>
        at com.mysql.cj.exceptions.ExceptionFactory.createException<span class="token punctuation">(</span>ExceptionFactory.java:85<span class="token punctuation">)</span>
        at com.mysql.cj.protocol.a.authentication.CachingSha2PasswordPlugin.nextAuthenticationStep<span class="token punctuation">(</span>CachingSha2PasswordPlugin.java:130<span class="token punctuation">)</span>
        <span class="token punctuation">..</span>. <span class="token number">142</span> common frames omitted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>解决办法：</strong> 在 <code>db.url</code> 后面加上 <code>allowPublicKeyRetrieval=true</code> 即可。</p><h4 id="第五步、以单点方式启动-nacos。" tabindex="-1"><a class="header-anchor" href="#第五步、以单点方式启动-nacos。" aria-hidden="true">#</a> 第五步、以单点方式启动 Nacos。</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> nacos/bin
<span class="token function">sh</span> startup.sh <span class="token parameter variable">-m</span> standalone
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>默认 <code>Nacos</code> 以后台模式启动，利用 <code>tail</code> 命令查看启动日志。可以看到 <code>Nacos</code> 默认端口为 <code>8848</code>，下 面日志说明 <code>Nacos</code> 单机模式已启动成功。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tail</span> <span class="token parameter variable">-f</span> /usr/local/nacos/logs/start.out
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="第六步、设置防火墙对-nacos-端口放行。" tabindex="-1"><a class="header-anchor" href="#第六步、设置防火墙对-nacos-端口放行。" aria-hidden="true">#</a> 第六步、设置防火墙对 Nacos 端口放行。</h4><table><thead><tr><th>端口</th><th>描述</th></tr></thead><tbody><tr><td>8848</td><td>主端口，客户端、控制台及OpenAPI所使用的HTTP端口</td></tr><tr><td>9848</td><td>客户端gRPC请求服务端端口，用于客户端向服务端发起连接和请求</td></tr><tr><td>9849</td><td>服务端gRPC请求服务端端口，用于服务间同步等</td></tr><tr><td>7848</td><td>Jraft请求服务端端口，用于处理服务端间的Raft相关请求</td></tr></tbody></table><p>如果服务器启动了防火墙，需要开放以下端口：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">8848</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">7848</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">9848</span>/tcp <span class="token parameter variable">--permanent</span>
firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">9849</span>/tcp <span class="token parameter variable">--permanent</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启防火墙使配置生效</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>firewall-cmd <span class="token parameter variable">--reload</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此时，<code>Nacos</code>已单机部署完毕。</p><h4 id="第七步-进入-nacos-管理界面" tabindex="-1"><a class="header-anchor" href="#第七步-进入-nacos-管理界面" aria-hidden="true">#</a> 第七步，进入 Nacos 管理界面</h4>`,26),b={href:"http://localhost:8848/nacos/",target:"_blank",rel:"noopener noreferrer"},k=a("img",{src:"http://oss.feny.ink/blogs/images/202312281325743.png",alt:"",loading:"lazy"},null,-1),h=t(`<h3 id="nacos集群模式运行" tabindex="-1"><a class="header-anchor" href="#nacos集群模式运行" aria-hidden="true">#</a> Nacos集群模式运行</h3><h4 id="集群部署架构图" tabindex="-1"><a class="header-anchor" href="#集群部署架构图" aria-hidden="true">#</a> 集群部署架构图</h4><figure><img src="http://oss.feny.ink/blogs/images/202401011259702.jpeg" alt="deployDnsVipMode.jpg" tabindex="0" loading="lazy"><figcaption>deployDnsVipMode.jpg</figcaption></figure><h4 id="第一步、环境准备" tabindex="-1"><a class="header-anchor" href="#第一步、环境准备" aria-hidden="true">#</a> 第一步、环境准备</h4><p>请确保是在环境中安装使用:</p><ol><li>64 bit OS Linux/Unix/Mac，推荐使用Linux系统。</li><li>64 bit JDK 1.8+；</li><li>Nginx；</li><li>3个或3个以上Nacos节点才能构成集群。</li></ol><p>服务器列表：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code># Nginx 服务器
192.168.0.143

# Nacos 服务器
192.168.0.134
192.168.0.136
192.168.0.161
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分别在<code>192.168.0.134</code>、<code>192.168.0.136</code>、<code>192.168.0.161</code>安装好Nacos和配置好数据源。</p><h4 id="第二步、下载安装-nacos" tabindex="-1"><a class="header-anchor" href="#第二步、下载安装-nacos" aria-hidden="true">#</a> 第二步、下载安装 Nacos</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/
<span class="token function">wget</span> https://github.com/alibaba/nacos/releases/download/2.3.0/nacos-server-2.3.0.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> nacos-server-2.3.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第三步、初始化数据库表-1" tabindex="-1"><a class="header-anchor" href="#第三步、初始化数据库表-1" aria-hidden="true">#</a> 第三步、初始化数据库表</h4><p>使用任意 <code>MySQL</code> 客户端工具连接到 <code>MySQL</code> 数据库服务器，创建名为<code>nacos</code>的数据库，之后使用 <code>MySQL</code> 客户端执 行 <code>/usr/local/nacos/conf/mysql-schema.sql</code> 文件，完成建表工作。<br><img src="http://oss.feny.ink/blogs/images/202312281325914.png" alt="" loading="lazy"></p><h4 id="第四步、配置-nacos-数据源-1" tabindex="-1"><a class="header-anchor" href="#第四步、配置-nacos-数据源-1" aria-hidden="true">#</a> 第四步、配置 Nacos 数据源</h4><p>编辑服务器中<code>Nacos</code> 的核心配置文件 <code>/usr/local/conf/application.properties</code>。</p><p>默认数据源配置都被<code>#</code>号注释，删除<code>#</code>号注释按下方示例配置数据源。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">spring.sql.init.platform</span><span class="token operator">=</span>mysql

<span class="token comment">### Count of DB:</span>
<span class="token assign-left variable">db.num</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment">### Connect URL of DB:</span>
<span class="token assign-left variable">db.url.0</span><span class="token operator">=</span>jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span><span class="token assign-left variable">connectTimeout</span><span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span><span class="token assign-left variable">socketTimeout</span><span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span><span class="token assign-left variable">autoReconnect</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useUnicode</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false<span class="token operator">&amp;</span><span class="token assign-left variable">serverTimezone</span><span class="token operator">=</span>UTC<span class="token operator">&amp;</span><span class="token assign-left variable">allowPublicKeyRetrieval</span><span class="token operator">=</span>true
<span class="token assign-left variable">db.user.0</span><span class="token operator">=</span>root
<span class="token assign-left variable">db.password.0</span><span class="token operator">=</span><span class="token number">123456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong> <code>192.168.0.134</code>、<code>192.168.0.136</code>、<code>192.168.0.161</code> 都需要配置<code>application.properties</code>。</p><p>也可以编辑好一台服务器的相关配置后，下载到本地后再上传到其他两台服务器直接替换源文件。</p></blockquote><p><strong>遇到的问题</strong><code>Nacos</code>启动时报以下错误错：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Caused by: com.mysql.cj.exceptions.UnableToConnectException: Public Key Retrieval is not allowed
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
        at sun.reflect.NativeConstructorAccessorImpl.newInstance<span class="token punctuation">(</span>NativeConstructorAccessorImpl.java:62<span class="token punctuation">)</span>
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance<span class="token punctuation">(</span>DelegatingConstructorAccessorImpl.java:45<span class="token punctuation">)</span>
        at java.lang.reflect.Constructor.newInstance<span class="token punctuation">(</span>Constructor.java:423<span class="token punctuation">)</span>
        at com.mysql.cj.exceptions.ExceptionFactory.createException<span class="token punctuation">(</span>ExceptionFactory.java:61<span class="token punctuation">)</span>
        at com.mysql.cj.exceptions.ExceptionFactory.createException<span class="token punctuation">(</span>ExceptionFactory.java:85<span class="token punctuation">)</span>
        at com.mysql.cj.protocol.a.authentication.CachingSha2PasswordPlugin.nextAuthenticationStep<span class="token punctuation">(</span>CachingSha2PasswordPlugin.java:130<span class="token punctuation">)</span>
        <span class="token punctuation">..</span>. <span class="token number">142</span> common frames omitted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>解决办法：</strong> 在 <code>db.url</code> 后面加上 <code>allowPublicKeyRetrieval=true</code> 即可。</p><h4 id="第五步、nacos-集群节点配置" tabindex="-1"><a class="header-anchor" href="#第五步、nacos-集群节点配置" aria-hidden="true">#</a> 第五步、Nacos 集群节点配置</h4><p>在 <code>/usr/local/nacos/conf</code> 目录下提供了集群示例文件<code>cluster.conf.example</code> 首先利用复制命令创建 <code>cluster.conf</code> 文件。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> cluster.conf.example cluster.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>之后打开 <code>cluster.conf</code>，添加所有 <code>Nacos</code> 集群节点 <code>IP </code>及端口，每台服务器上的<code>nacos</code>都要配置。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">192.168</span>.0.134:8848
<span class="token number">192.168</span>.0.138:8848
<span class="token number">192.168</span>.0.161:8848
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong> <code>192.168.0.134</code>、<code>192.168.0.136</code>、<code>192.168.0.161</code> 都需要配置<code>cluster.conf</code>。</p></blockquote><h4 id="第六步、启动-nacos-服务器" tabindex="-1"><a class="header-anchor" href="#第六步、启动-nacos-服务器" aria-hidden="true">#</a> 第六步、启动 <code>Nacos</code> 服务器</h4><p>在3台 <code>Nacos</code> 节点服务器上分别执行下面的启动命令：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sh</span> /usr/local/nacos/bin/startup.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong> 集群模式下并不需要增加<code>-m</code>参数，默认就是以集群方式启动。</p></blockquote><p>启动时可以通过 tail 命令观察启动过程。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tail</span> <span class="token parameter variable">-f</span> /usr/local/nacos/logs/start.out
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,33),g=a("code",null,"IP",-1),f=a("code",null,"nacos",-1),_=a("img",{src:"http://oss.feny.ink/blogs/images/202312281325509.png",alt:"",loading:"lazy"},null,-1),x={href:"http://192.168.0.134:8848/nacos",target:"_blank",rel:"noopener noreferrer"},y={href:"http://192.168.0.136:8848/nacos",target:"_blank",rel:"noopener noreferrer"},E={href:"http://192.168.0.138:8848/nacos",target:"_blank",rel:"noopener noreferrer"},N=t(`<img src="http://oss.feny.ink/blogs/images/202401011644078.png" alt="image-20240101164412019" style="zoom:50%;"><h4 id="第七步、nginx-代理-nacos-集群" tabindex="-1"><a class="header-anchor" href="#第七步、nginx-代理-nacos-集群" aria-hidden="true">#</a> 第七步、Nginx 代理 Nacos 集群</h4><p>在已安装nginx的<code>192.168.0.143</code>服务器上</p><p>在<code>nginx</code>的<code>conf.d</code>目录下新建<code>nacos.conf</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /nginx/conf/conf.d
<span class="token function">vim</span> nginx.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>内容以下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># Nacos 集群服务</span>
upstream nacos_server <span class="token punctuation">{</span>
    server <span class="token number">192.168</span>.0.134:8848<span class="token punctuation">;</span>
    server <span class="token number">192.168</span>.0.136:8848<span class="token punctuation">;</span>
    server <span class="token number">192.168</span>.0.161:8848<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  nacos.example.com<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http://nacos_server<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>退出保存，重启<code>nginx</code></p><p>修改本地<code>hosts</code>文件，在<code>hsots</code>文件最后添加</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># C:\\Windows\\System32\\drivers\\etc</span>
<span class="token number">192.168</span>.0.143 nacos.example.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,10),S={href:"http://nacos.example.com/nacos",target:"_blank",rel:"noopener noreferrer"},A=t(`<p>完成部署！！！</p><h4 id="遇到的问题" tabindex="-1"><a class="header-anchor" href="#遇到的问题" aria-hidden="true">#</a> 遇到的问题</h4><p>问题一：如果<code>nginx</code>代理<code>nacos</code>将的访问地址<code>http://nacos.example.com/nacos</code>改为<code>http://nacos.example.com</code>的形式，<code>http://nacos.example.com</code>访问控制台没问题，但是<code>Spring Boot</code>项目注册服务启动时就会报错。</p><p>错误信息：</p><div class="language-tex line-numbers-mode" data-ext="tex"><pre class="language-tex"><code>Caused by: com.alibaba.nacos.api.exception.NacosException: user not found!
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>暂时没有找到解决办法</p><h2 id="二、docker-环境安装-nacos" tabindex="-1"><a class="header-anchor" href="#二、docker-环境安装-nacos" aria-hidden="true">#</a> 二、Docker 环境安装 Nacos</h2><h3 id="单机模式运行-挂载目录方式" tabindex="-1"><a class="header-anchor" href="#单机模式运行-挂载目录方式" aria-hidden="true">#</a> 单机模式运行--挂载目录方式</h3><h4 id="第一步、拉取镜像" tabindex="-1"><a class="header-anchor" href="#第一步、拉取镜像" aria-hidden="true">#</a> 第一步、拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="第二步、创建挂载目录" tabindex="-1"><a class="header-anchor" href="#第二步、创建挂载目录" aria-hidden="true">#</a> 第二步、创建挂载目录</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/docker/nacos/conf /data/docker/nacos/logs /data/docker/nacos/data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>-p 作用是在创建多级文件时，不存在某一级文件就会创建，存在就使用原文件</p></blockquote><h4 id="第三步、复制容器的相关文件到挂载目录" tabindex="-1"><a class="header-anchor" href="#第三步、复制容器的相关文件到挂载目录" aria-hidden="true">#</a> 第三步、复制容器的相关文件到挂载目录</h4><p>启动<code>Nacos</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> nacos <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8848</span>:8848 <span class="token parameter variable">-e</span> <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone  nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>复制容器的相关文件到挂载目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">cp</span> nacos:/home/nacos/conf /data/docker/nacos
<span class="token function">docker</span> <span class="token function">cp</span> nacos:/home/nacos/logs /data/docker/nacos
<span class="token function">docker</span> <span class="token function">cp</span> nacos:/home/nacos/data /data/docker/nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>停止<code>Nacos</code>容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> stop nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>删除<code>Nacos</code>容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">rm</span> nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="第四步、初始化数据库表" tabindex="-1"><a class="header-anchor" href="#第四步、初始化数据库表" aria-hidden="true">#</a> 第四步、初始化数据库表</h4><p>使用任意 <code>MySQL</code> 客户端工具连接到 <code>MySQL</code> 数据库服务器，创建名为<code>nacos</code>的数据库，之后使用 <code>MySQL</code> 客户端执 行 <code>/data/docker/nacos/conf/mysql-schema.sql</code> 文件，完成建表工作。 <img src="http://oss.feny.ink/blogs/images/202312281325914.png" alt="" loading="lazy"></p><h4 id="第五步、配置-nacos-数据源" tabindex="-1"><a class="header-anchor" href="#第五步、配置-nacos-数据源" aria-hidden="true">#</a> 第五步、配置 Nacos 数据源</h4><p>编辑 <code>application.properties</code>文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /data/docker/nacos/conf/application.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>修改以下信息，默认数据源配置都被<code>#</code>号注释，删除注释按下方示例配置数据源即可。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># /data/docker/nacos/conf/application.properties</span>
<span class="token assign-left variable">spring.sql.init.platform</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">db.num</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># 数据库连接地址和数据库名称修改成自己的</span>
<span class="token assign-left variable">db.url.0</span><span class="token operator">=</span>jdbc:mysql://192.168.0.143:3306/nacos?characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span><span class="token assign-left variable">connectTimeout</span><span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span><span class="token assign-left variable">socketTimeout</span><span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span><span class="token assign-left variable">autoReconnect</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useUnicode</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false<span class="token operator">&amp;</span><span class="token assign-left variable">serverTimezone</span><span class="token operator">=</span>UTC<span class="token operator">&amp;</span><span class="token assign-left variable">allowPublicKeyRetrieval</span><span class="token operator">=</span>true
<span class="token comment"># 数据库用户</span>
<span class="token assign-left variable">db.user.0</span><span class="token operator">=</span>root
<span class="token comment"># 数据库密码</span>
<span class="token assign-left variable">db.password.0</span><span class="token operator">=</span><span class="token number">123456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第六步、单机模式启动-nacos" tabindex="-1"><a class="header-anchor" href="#第六步、单机模式启动-nacos" aria-hidden="true">#</a> 第六步、单机模式启动 Nacos</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">8848</span>:8848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">9848</span>:9848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">9849</span>:9849 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">7848</span>:7848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>ip <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos/conf/:/home/nacos/conf <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos/logs:/home/nacos/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos/data:/home/nacos/data <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span>nacos <span class="token punctuation">\\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span>
nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看启动日志：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> <span class="token parameter variable">-n</span> nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>显示如下内容，表示启动成功：</p><img src="http://oss.feny.ink/blogs/images/202401012222414.png" alt="image-20240101222210347" style="zoom:50%;"><h3 id="单机模式运行-docker-e-参数配置方式" tabindex="-1"><a class="header-anchor" href="#单机模式运行-docker-e-参数配置方式" aria-hidden="true">#</a> 单机模式运行--docker -e 参数配置方式</h3><h4 id="第一步、拉取镜像-1" tabindex="-1"><a class="header-anchor" href="#第一步、拉取镜像-1" aria-hidden="true">#</a> 第一步、拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="第二步、启动-nacos" tabindex="-1"><a class="header-anchor" href="#第二步、启动-nacos" aria-hidden="true">#</a> 第二步、启动 Nacos</h4><p>如果不想连接<code>MySQL</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">8848</span>:8848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">9848</span>:9848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">9849</span>:9849 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">7848</span>:7848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>ip <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_ENABLE</span><span class="token operator">=</span>true <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_TOKEN</span><span class="token operator">=</span>cjViZWc2MmRndmdwMjNiNGoyNDZnNGN1bTQ0bWpzMXo<span class="token operator">=</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_IDENTITY_KEY</span><span class="token operator">=</span>serverIdentity <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_IDENTITY_VALUE</span><span class="token operator">=</span>security <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span>nacos <span class="token punctuation">\\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span>
nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>连接MySQL数据库</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">8848</span>:8848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">9848</span>:9848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">9849</span>:9849 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">7848</span>:7848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>ip <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">SPRING_DATASOURCE_PLATFORM</span><span class="token operator">=</span>mysql <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_SERVICE_HOST</span><span class="token operator">=</span><span class="token number">192.168</span>.0.143 <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_SERVICE_PORT</span><span class="token operator">=</span><span class="token number">3306</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_SERVICE_DB_NAME</span><span class="token operator">=</span>nacos <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_SERVICE_USER</span><span class="token operator">=</span>nacos <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_SERVICE_PASSWORD</span><span class="token operator">=</span>nacos <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_ENABLE</span><span class="token operator">=</span>true <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_TOKEN</span><span class="token operator">=</span>cjViZWc2MmRndmdwMjNiNGoyNDZnNGN1bTQ0bWpzMXo<span class="token operator">=</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_IDENTITY_KEY</span><span class="token operator">=</span>serverIdentity <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_AUTH_IDENTITY_VALUE</span><span class="token operator">=</span>security <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span>nacos <span class="token punctuation">\\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span>
nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>-e</code>参数各名词解析<a href="#%E5%85%AC%E5%85%B1%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE">请看这里</a></p><p>查看启动日志：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果启动时添加了<code>MySQL</code>连接，但是还没有在<code>mysql</code>中创建<code>nacos</code>数据库和初始化相关表，此时启动会报错。</p><p>复制<code>nacos</code>容器中的<code>mysql-schema.sql</code>出来，导入<code>nacos</code>数据库中</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">cp</span> nacos:/home/nacos/conf/mysql-schema.sql /想要复制到的目录
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>数据库初始化表后，重新运行<code>nacos</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="nacos集群模式运行-1" tabindex="-1"><a class="header-anchor" href="#nacos集群模式运行-1" aria-hidden="true">#</a> Nacos集群模式运行</h3><h4 id="第一步、拉取镜像-2" tabindex="-1"><a class="header-anchor" href="#第一步、拉取镜像-2" aria-hidden="true">#</a> 第一步、拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="第二步、创建挂载目录-1" tabindex="-1"><a class="header-anchor" href="#第二步、创建挂载目录-1" aria-hidden="true">#</a> 第二步、创建挂载目录</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/docker/nacos_cluster_1/conf /data/docker/nacos_cluster_1/logs /data/docker/nacos_cluster_1/data
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/docker/nacos_cluster_2/conf /data/docker/nacos_cluster_1/logs /data/docker/nacos_cluster_1/data
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /data/docker/nacos_cluster_3/conf /data/docker/nacos_cluster_1/logs /data/docker/nacos_cluster_1/data
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>-p 作用是在创建多级文件时，不存在某一级文件就会创建，存在就使用原文件</p><p><em>注意：</em> 这里为了演示所以将<code>nacos</code>部署在了同一台服务器上，实际环境中不推荐这样做，实际中还是准备3台服务器，在3台服务器上分别部署。</p></blockquote><h4 id="第三步、复制容器的相关文件到挂载目录-1" tabindex="-1"><a class="header-anchor" href="#第三步、复制容器的相关文件到挂载目录-1" aria-hidden="true">#</a> 第三步、复制容器的相关文件到挂载目录</h4><p>启动<code>Nacos</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>nacos <span class="token parameter variable">-e</span> <span class="token assign-left variable">MODE</span><span class="token operator">=</span>standalone nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>复制容器的相关文件到挂载目录</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">cp</span> nacos:/home/nacos/conf /data/docker/nacos_cluster_1
<span class="token function">docker</span> <span class="token function">cp</span> nacos:/home/nacos/logs /data/docker/nacos_cluster_1
<span class="token function">docker</span> <span class="token function">cp</span> nacos:/home/nacos/data /data/docker/nacos_cluster_1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将<code>/data/docker/nacos_1</code>中的目录分别复制到<code>/data/docker/nacos_2</code>和<code>/data/docker/nacos_3</code>中</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> <span class="token parameter variable">-rv</span> /data/docker/nacos_cluster_1/* /data/docker/nacos_cluster_2/
<span class="token function">cp</span> <span class="token parameter variable">-rv</span> /data/docker/nacos_cluster_1/* /data/docker/nacos_cluster_3/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>停止<code>Nacos</code>容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> stop nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>删除<code>Nacos</code>容器</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">rm</span> nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="第四步、初始化数据库表-1" tabindex="-1"><a class="header-anchor" href="#第四步、初始化数据库表-1" aria-hidden="true">#</a> 第四步、初始化数据库表</h4><p>使用任意 <code>MySQL</code> 客户端工具连接到 <code>MySQL</code> 数据库服务器，创建名为<code>nacos</code>的数据库，之后使用 <code>MySQL</code> 客户端执 行 <code>nacos/conf/mysql-schema.sql</code> 文件，完成建表工作。 <img src="http://oss.feny.ink/blogs/images/202312281325914.png" alt="" loading="lazy"></p><h4 id="第五步、配置-nacos-数据源-1" tabindex="-1"><a class="header-anchor" href="#第五步、配置-nacos-数据源-1" aria-hidden="true">#</a> 第五步、配置 Nacos 数据源</h4><p>修改配置文件 <code>application.properties</code></p><p>默认数据源配置都被<code>#</code>号注释，删除注释按下方示例配置数据源即可。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">spring.sql.init.platform</span><span class="token operator">=</span>mysql
<span class="token assign-left variable">db.num</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">db.url.0</span><span class="token operator">=</span>jdbc:mysql://192.168.0.143:3306/nacos?characterEncoding<span class="token operator">=</span>utf8<span class="token operator">&amp;</span><span class="token assign-left variable">connectTimeout</span><span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&amp;</span><span class="token assign-left variable">socketTimeout</span><span class="token operator">=</span><span class="token number">3000</span><span class="token operator">&amp;</span><span class="token assign-left variable">autoReconnect</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useUnicode</span><span class="token operator">=</span>true<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false<span class="token operator">&amp;</span><span class="token assign-left variable">serverTimezone</span><span class="token operator">=</span>UTC<span class="token operator">&amp;</span><span class="token assign-left variable">allowPublicKeyRetrieval</span><span class="token operator">=</span>true
<span class="token assign-left variable">db.user.0</span><span class="token operator">=</span>root
<span class="token assign-left variable">db.password.0</span><span class="token operator">=</span><span class="token number">123456</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="第六步、集群模式运行" tabindex="-1"><a class="header-anchor" href="#第六步、集群模式运行" aria-hidden="true">#</a> 第六步、集群模式运行</h4><p>启动<code>nacos_1</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">18848</span>:8848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">19848</span>:9848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">19849</span>:9849 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">17848</span>:7848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>ip <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_SERVERS</span><span class="token operator">=</span><span class="token string">&quot;192.168.0.143:28848 192.168.0.143:38848&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_1/conf/:/home/nacos/conf <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_1/logs:/home/nacos/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_1/data:/home/nacos/data <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span>nacos_cluster_1 <span class="token punctuation">\\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span>
nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong>-e NACOS_SERVERS=&quot;192.168.0.143:18848 192.168.0.143:38848&quot;，这是另外两个Nacos服务的IP:端口，不包括自己</p></blockquote><p>查看启动日志</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> nacos_cluster_1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动\`nacos_2</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">28848</span>:8848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">29848</span>:9848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">29849</span>:9849 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">27848</span>:7848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>ip <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_SERVERS</span><span class="token operator">=</span><span class="token string">&quot;192.168.0.143:18848 192.168.0.143:38848&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_2/conf/:/home/nacos/conf <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_2/logs:/home/nacos/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_2/data:/home/nacos/data <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span>nacos_cluster_2 <span class="token punctuation">\\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span>
nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong>-e NACOS_SERVERS=&quot;192.168.0.143:18848 192.168.0.143:38848&quot;，这是另外两个Nacos服务的IP:端口，不包括自己</p></blockquote><p>查看启动日志</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> nacos_cluster_2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动<code>nacos_</code>3</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">38848</span>:8848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">39848</span>:9848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">39849</span>:9849 <span class="token punctuation">\\</span>
<span class="token parameter variable">-p</span> <span class="token number">37848</span>:7848 <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">PREFER_HOST_MODE</span><span class="token operator">=</span>ip <span class="token punctuation">\\</span>
<span class="token parameter variable">-e</span> <span class="token assign-left variable">NACOS_SERVERS</span><span class="token operator">=</span><span class="token string">&quot;192.168.0.143:18848 192.168.0.143:28848&quot;</span> <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_3/conf/:/home/nacos/conf <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_3/logs:/home/nacos/logs <span class="token punctuation">\\</span>
<span class="token parameter variable">-v</span> /data/docker/nacos_cluster_3/data:/home/nacos/data <span class="token punctuation">\\</span>
<span class="token parameter variable">--name</span><span class="token operator">=</span>nacos_cluster_3 <span class="token punctuation">\\</span>
<span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token punctuation">\\</span>
nacos/nacos-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>注意：</strong>-e NACOS_SERVERS=&quot;192.168.0.143:18848 192.168.0.143:28848&quot;，这是另外两个Nacos服务的IP:端口，不包括自己</p></blockquote><p>查看启动日志</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> nacos_cluster_3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>3个<code>Nacos</code>服务都启动成功后</p><img src="http://oss.feny.ink/blogs/images/202401021346170.png" alt="image-20240102134649124" style="zoom:50%;">`,92),R={href:"http://192.168.0.143:18848/nacos",target:"_blank",rel:"noopener noreferrer"},T=a("img",{src:"http://oss.feny.ink/blogs/images/202401021346817.png",alt:"image-20240102134609737",style:{zoom:"50%"}},null,-1),C={href:"http://192.168.0.143:28848/nacos",target:"_blank",rel:"noopener noreferrer"},I=a("img",{src:"http://oss.feny.ink/blogs/images/202401021346118.png",alt:"image-20240102134633054",style:{zoom:"50%"}},null,-1),O={href:"http://192.168.0.143:38848/nacos",target:"_blank",rel:"noopener noreferrer"},q=a("img",{src:"http://oss.feny.ink/blogs/images/202401021348478.png",alt:"image-20240102134819416",style:{zoom:"50%"}},null,-1),M=a("h4",{id:"第七步-nginx代理nacos集群地址",tabindex:"-1"},[a("a",{class:"header-anchor",href:"#第七步-nginx代理nacos集群地址","aria-hidden":"true"},"#"),s(" 第七步：Nginx代理Nacos集群地址")],-1),w=a("code",null,"Docker",-1),D=a("code",null,"Nginx",-1),L={href:"https://www.feny.ink/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/Nginx%20%E5%AE%89%E8%A3%85.html#docker-%E4%B8%8B%E5%AE%89%E8%A3%85",target:"_blank",rel:"noopener noreferrer"},P=t(`<p>在<code>nginx</code>的<code>conf.d</code>目录下新建<code>nacos.conf</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> nacos.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>配置如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nacos.conf</span>
<span class="token comment"># Nacos 集群服务</span>
upstream nacos_server <span class="token punctuation">{</span>
    server <span class="token number">192.168</span>.0.143:18848<span class="token punctuation">;</span>
    server <span class="token number">192.168</span>.0.143:28848<span class="token punctuation">;</span>
    server <span class="token number">192.168</span>.0.143:38848<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token comment"># 有域名可以替换为域名，如</span>
    <span class="token comment"># server_name  nacos.example.com;</span>
    server_name  <span class="token number">192.168</span>.0.143<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http://nacos_server<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span>
		proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
		proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启<code>Nginx</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,6),U={href:"http://192.168.143/nacos",target:"_blank",rel:"noopener noreferrer"},j=t(`<img src="http://oss.feny.ink/blogs/images/202401021400377.png" alt="image-20240102140010295" style="zoom:50%;"><p>Nginx代理Nacos集群地址完成！！！</p><h4 id="遇到的问题-1" tabindex="-1"><a class="header-anchor" href="#遇到的问题-1" aria-hidden="true">#</a> 遇到的问题</h4><h5 id="问题一-docker-安装nginx时没有-p映射对应的端口-进行代理时请求无法访问" tabindex="-1"><a class="header-anchor" href="#问题一-docker-安装nginx时没有-p映射对应的端口-进行代理时请求无法访问" aria-hidden="true">#</a> 问题一：Docker 安装Nginx时没有<code>-p</code>映射对应的端口，进行代理时请求<code>无法访问</code></h5><p>如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen       <span class="token number">8080</span><span class="token punctuation">;</span>
    server_name  <span class="token number">192.168</span>.0.143<span class="token punctuation">;</span>
    location /nacos <span class="token punctuation">{</span>
        proxy_pass http://nacos<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),z={href:"http://192.168.0.143:8080",target:"_blank",rel:"noopener noreferrer"},V=t(`<img src="http://oss.feny.ink/blogs/images/202401021417704.png" alt="image-20240102141704632" style="zoom:50%;"><p>这是因为<code>docker run nginx</code>时并没有映射相应端口。</p><p><strong>解决办法：</strong></p><p>动态修改Docker运行中的端口映射</p><p>查询容器<code>ip</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> inspect <span class="token parameter variable">--format</span> <span class="token string">&#39;{{ .NetworkSettings.IPAddress }}&#39;</span> nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>Iptables</code>端口映射</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables <span class="token parameter variable">-t</span> nat <span class="token parameter variable">-A</span> DOCKER <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token number">8080</span> <span class="token parameter variable">-j</span> DNAT --to-destination <span class="token number">172.17</span>.0.5:8080
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,8),H={href:"http://192.168.0.143:8080",target:"_blank",rel:"noopener noreferrer"},B=t(`<h3 id="公共属性配置" tabindex="-1"><a class="header-anchor" href="#公共属性配置" aria-hidden="true">#</a> 公共属性配置</h3><table><thead><tr><th>属性名称</th><th style="text-align:center;">描述</th><th></th></tr></thead><tbody><tr><td>MODE</td><td style="text-align:center;">系统启动方式：集群/单机</td><td>cluster/standalone<br>默认： <strong>cluster</strong></td></tr><tr><td>NACOS_SERVERS</td><td style="text-align:center;">集群地址</td><td>ip1:port1空格ip2:port2 空格ip3:port3</td></tr><tr><td>PREFER_HOST_MODE</td><td style="text-align:center;">支持IP还是域名模式</td><td>hostname/ip <br>默认：<strong>ip</strong></td></tr><tr><td>NACOS_SERVER_PORT</td><td style="text-align:center;">Nacos运行端口</td><td>默认： <strong>8848</strong></td></tr><tr><td>SPRING_DATASOURCE_PLATFORM</td><td style="text-align:center;">单机模式下支持MYSQL数据库</td><td>mysql/空 默认：空</td></tr><tr><td>MYSQL _SERVICE_HOST</td><td style="text-align:center;">数据库连接地址</td><td></td></tr><tr><td>MYSQL_SERVICE_PORT</td><td style="text-align:center;">数据库端口</td><td>默认 : <strong>3306</strong></td></tr><tr><td>MYSQL_SERVICE_DB_NAME</td><td style="text-align:center;">数据库库名</td><td></td></tr><tr><td>MYSQL_SERVICE_USER</td><td style="text-align:center;">数据库用户名</td><td></td></tr><tr><td>MYSQL_SERVICE_PASSWORD</td><td style="text-align:center;">数据库用户密码</td><td></td></tr><tr><td>MYSQL_SERVICE DB_PARAM</td><td style="text-align:center;">数据库连接参数</td><td>默认：<strong><br>characterEncoding=utf8<br>&amp;connectTimeout=1000<br>&amp;socketTimeout=3000<br>&amp;autoReconnect=true<br>&amp;useSSL=false</strong></td></tr><tr><td>MYSOL DATABASE_NUM</td><td style="text-align:center;">数据库编号</td><td>默认：<strong>1</strong></td></tr><tr><td>NACOS_AUTH_ENABLE</td><td style="text-align:center;">是否开启权限系统</td><td>默认：false</td></tr><tr><td>NACOS_AUTH TOKEN_EXPIRE_SECONDS</td><td style="text-align:center;">token失效时间</td><td>默认：18000</td></tr><tr><td>NACOS_AUTH_TOKEN</td><td style="text-align:center;">默认 token<br>nacos.core.auth.plugin.nacos.token.secret.key</td><td>默认：空<br>NACOS_AUTH_ENABLE=TRUE时必填<br>推荐将配置项设置为<strong>Base64编码</strong>的字符串，且<strong>原始密钥长度不得低于32字符</strong></td></tr><tr><td>NACOS_AUTH_IDENTITY_KEY</td><td style="text-align:center;">nacos.core.auth.server.identity.key</td><td>NACOS_AUTH_ENABLE=TRUE时必填</td></tr><tr><td>NACOS_AUTH_IDENTITY_VALUE</td><td style="text-align:center;">nacos.core.auth.server.identity.value</td><td>NACOS_AUTH_ENABLE=TRUE时必填</td></tr></tbody></table><h2 id="三、nacos-开启身份认证" tabindex="-1"><a class="header-anchor" href="#三、nacos-开启身份认证" aria-hidden="true">#</a> 三、Nacos 开启身份认证</h2><p><code>Nacos</code>自<code>2.2.2</code>版本开始，在未开启鉴权时，默认控制台将不需要登录即可访问，同时在控制台中给予提示，提醒用户当前集群未开启鉴权。 在用户开启鉴权后，控制台才需要进行登录访问。</p><p>修改<code>application.properties</code>中的配置信息为：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 在2.2.0.1版本后默认为false</span>
<span class="token assign-left variable">nacos.core.auth.enabled</span><span class="token operator">=</span>true

<span class="token comment"># 在2.2.0.1版本后默认为空，随自己喜欢自定义</span>
<span class="token assign-left variable">nacos.core.auth.server.identity.key</span><span class="token operator">=</span>serverIdentity

<span class="token comment"># 在2.2.0.1版本后默认为空，随自己喜欢自定义</span>
<span class="token assign-left variable">nacos.core.auth.server.identity.value</span><span class="token operator">=</span>security

<span class="token comment"># 自定义密钥时，推荐将配置项设置为Base64编码的字符串，且原始密钥长度不得低于32字符</span>
<span class="token assign-left variable">nacos.core.auth.plugin.nacos.token.secret.key</span><span class="token operator">=</span>cjViZWc2MmRndmdwMjNiNGoyNDZnNGN1bTQ0bWpzMXo<span class="token operator">=</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为方便省事，使用<code>Hutool</code>工具生成 <code>nacos.core.auth.plugin.nacos.token.secret.key</code> 的自定义密钥：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">RandomUtil</span></span><span class="token punctuation">;</span>

<span class="token comment">// 生成Nacos密码</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">randomString</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="四、服务注册到-nacos" tabindex="-1"><a class="header-anchor" href="#四、服务注册到-nacos" aria-hidden="true">#</a> 四、服务注册到 Nacos</h2><h3 id="_1-、新建项目" tabindex="-1"><a class="header-anchor" href="#_1-、新建项目" aria-hidden="true">#</a> （1）、新建项目</h3><p>在 IntelliJ IDEA 新建项目<br><img src="http://oss.feny.ink/blogs/images/202312281326203.png" alt="" loading="lazy"></p>`,11),Q={href:"http://start.aliyun.com",target:"_blank",rel:"noopener noreferrer"},F=a("br",null,null,-1),Y=a("img",{src:"http://oss.feny.ink/blogs/images/202312281326235.png",alt:"",loading:"lazy"},null,-1),K=t(`<p>依赖选择如下：<br><img src="http://oss.feny.ink/blogs/images/202312281326925.png" alt="" loading="lazy"><br> 选择完成后点击 Next，项目名，存放路径按自己喜好设置好，点击Finish完成</p><h3 id="_2-、服务注册到-nacos" tabindex="-1"><a class="header-anchor" href="#_2-、服务注册到-nacos" aria-hidden="true">#</a> （2）、服务注册到 Nacos</h3><p>打开 application.yml 文件，配置 Nacos 服务地址</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">application</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>alibaba<span class="token punctuation">-</span>study
    <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
        <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
            <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
                <span class="token comment"># 命名空间，一般多环境时使用，如：dev、test、prod</span>
                <span class="token key atrule">namespace</span><span class="token punctuation">:</span> public
                <span class="token key atrule">group</span><span class="token punctuation">:</span> DEFAULT_GROUP
                <span class="token comment"># Nacos服务器IP地址:端口</span>
                <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.0.143<span class="token punctuation">:</span><span class="token number">8848</span>
                <span class="token comment"># 用户名，如果Nacos未开启身份认证，请注释掉</span>
                <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
                <span class="token comment"># 默认密码为 nacos</span>
                <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>如果<code>nacos</code>服务做了<code>nginx</code>代理，然后Spring Boot项目启动失败，在<code> server-addr</code>加上<code>http://</code>试试</p><p>如原来<code>server-addr: nacos.example.com</code>，改为<code>server-addr: http://nacos.example.com</code></p></div><h3 id="_3-、启动服务" tabindex="-1"><a class="header-anchor" href="#_3-、启动服务" aria-hidden="true">#</a> （3）、启动服务</h3><p>服务启动成功后，在Nacos控制台--服务管理--服务列表中看到有服务，表示服务注册成功</p><img src="http://oss.feny.ink/blogs/images/202312281326377.png" style="zoom:50%;"><h2 id="五、配置管理" tabindex="-1"><a class="header-anchor" href="#五、配置管理" aria-hidden="true">#</a> 五、配置管理</h2>`,9),G={href:"https://blog.csdn.net/ImisLi/article/details/128745872",target:"_blank",rel:"noopener noreferrer"},W={href:"https://blog.csdn.net/qinxun2008081/article/details/131347990",target:"_blank",rel:"noopener noreferrer"},X=t(`<p>配置<code>pom.xml</code></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
    &lt;version&gt;3.1.4&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建<code>bootstrap.yml</code></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> user<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//192.168.0.164
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> public
        <span class="token comment"># 文件扩展名，默认</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>Nacos</code>默认读取配置文件结构：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>S{spring.application.name}-\${spring.profiles.active}.\${spring.cloud.nacos.config.file-extension}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="http://oss.feny.ink/blogs/images/202401031435514.png" alt="image-20240103143547445" tabindex="0" loading="lazy"><figcaption>image-20240103143547445</figcaption></figure><p>所以创建配置时要注意。</p><p>如果想自定义读取指定的配置，如定义的<code>spring.application.name=test-service</code>，创建的配置为<code>custom-service.yaml</code></p><p>具体配置如下：</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10080</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>service
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> public
        <span class="token comment"># 文件扩展名</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
        <span class="token comment"># 指定配置文件名</span>
        <span class="token key atrule">prefix</span><span class="token punctuation">:</span> custom<span class="token punctuation">-</span>service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="http://oss.feny.ink/blogs/images/202401031444113.png" alt="image-20240103144455054" tabindex="0" loading="lazy"><figcaption>image-20240103144455054</figcaption></figure><h3 id="遇到的问题-2" tabindex="-1"><a class="header-anchor" href="#遇到的问题-2" aria-hidden="true">#</a> 遇到的问题</h3><h4 id="问题一-add-a-spring-config-import-nacos-property-to-your-configuration" tabindex="-1"><a class="header-anchor" href="#问题一-add-a-spring-config-import-nacos-property-to-your-configuration" aria-hidden="true">#</a> 问题一：Add a spring.config.import=nacos: property to your configuration.</h4><p>启动报错：</p><figure><img src="http://oss.feny.ink/blogs/images/202401031255841.png" alt="image-20240103125558782" tabindex="0" loading="lazy"><figcaption>image-20240103125558782</figcaption></figure><h4 id="解决方法" tabindex="-1"><a class="header-anchor" href="#解决方法" aria-hidden="true">#</a> <strong>解决方法</strong></h4><p>因为 SpringCloud 2020.* 版本把<code>bootstrap</code>禁用了，导致在读取文件的时候读取不到而报错，所以我们只要把<code>bootstrap</code>重新导入进来就会生效了。</p><h5 id="添加pom" tabindex="-1"><a class="header-anchor" href="#添加pom" aria-hidden="true">#</a> <strong>添加pom</strong></h5><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,20);function $(Z,J){const n=c("ExternalLinkIcon");return l(),p("div",null,[r,a("p",null,[s("访问 "),d,s("："),a("a",u,[s("https://github.com/alibaba/nacos/releases/"),e(n)]),s("获取"),v]),m,a("p",null,[s("打开浏览器，地址栏输入："),a("a",b,[s("http://localhost:8848/nacos/"),e(n)]),k]),h,a("p",null,[s("当确保所有节点均启动成功，打开浏览器访问对应的"),g,s("地址"),f,s("后台，便可看到集群列表 "),_,s(" 分别打开"),a("a",x,[s("http://192.168.0.134:8848/nacos"),e(n)]),s("、"),a("a",y,[s("http://192.168.0.136:8848/nacos"),e(n)]),s("、"),a("a",E,[s("http://192.168.0.138:8848/nacos"),e(n)]),s("，可以看到集群的节点")]),N,a("p",null,[s("访问"),a("a",S,[s("http://nacos.example.com/nacos"),e(n)])]),A,a("p",null,[a("a",R,[s("http://192.168.0.143:18848/nacos"),e(n)])]),T,a("p",null,[a("a",C,[s("http://192.168.0.143:28848/nacos"),e(n)])]),I,a("p",null,[a("a",O,[s("http://192.168.0.143:38848/nacos"),e(n)])]),q,M,a("p",null,[w,s("安装"),D,s("，具体步骤"),a("a",L,[s("请看这里"),e(n)])]),P,a("p",null,[s("浏览器打开"),a("a",U,[s("http://192.168.143/nacos"),e(n)])]),j,a("p",null,[s("浏览器请求"),a("a",z,[s("http://192.168.0.143:8080"),e(n)])]),V,a("p",null,[s("再次请求"),a("a",H,[s("http://192.168.0.143:8080"),e(n)]),s("，就可以了！！！")]),B,a("p",null,[s("选择Spring Initializr-->选Custom，填写阿里 "),a("a",Q,[s("http://start.aliyun.com"),e(n)]),s("，点击Next进行下一步"),F,Y]),K,a("p",null,[s("学习地址："),a("a",G,[s("https://blog.csdn.net/ImisLi/article/details/128745872"),e(n)])]),a("p",null,[a("a",W,[s("https://blog.csdn.net/qinxun2008081/article/details/131347990"),e(n)])]),X])}const na=o(i,[["render",$],["__file","Nacos.html.vue"]]);export{na as default};
